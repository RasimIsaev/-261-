<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ –§–ó ‚Ññ 261</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="calculator">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ –§–ó ‚Ññ 261</h1>
        <form id="calc-form" class="calc-form-inline">
            <div class="calc-input-row">
                <button type="button" class="remove-row">-</button>
                <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                <label for="amount">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                <input type="number" class="amount" required> —Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a), 
                <label for="start-period">–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                <input type="month" class="start-period" required>
                <label for="end-period">–ø–æ</label>
                <input type="month" class="end-period" required>
            </div>
            <button type="button" id="add-row">+</button>
            <button type="submit">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="calculation-container" class="calculation-container">
        <button id="copy-results" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã">üìã</button>
        <div id="calculation-process" class="calculation-process"></div>
    </div>
    <script>
        document.getElementById('add-row').addEventListener('click', function () {
            const calcForm = document.getElementById('calc-form');
            const newRow = document.createElement('div');
            newRow.classList.add('calc-input-row');

            newRow.innerHTML = `
                <button type="button" class="remove-row">-</button>
                <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                <input type="number" class="amount" required> —Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a), 
                <label>–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                <input type="month" class="start-period" required>
                <label>–ø–æ</label>
                <input type="month" class="end-period" required>
            `;

            calcForm.insertBefore(newRow, document.getElementById('add-row'));
            addRemoveRowListener(newRow.querySelector('.remove-row'));
        });

        function addRemoveRowListener(button) {
            button.addEventListener('click', function () {
                button.parentElement.remove();
            });
        }

        document.querySelectorAll('.remove-row').forEach(addRemoveRowListener);

        document.getElementById('calc-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const amounts = document.querySelectorAll('.amount');
            const startPeriods = document.querySelectorAll('.start-period');
            const endPeriods = document.querySelectorAll('.end-period');
            const calcNames = document.querySelectorAll('.calc-name');
            const rate = 9.5 / 100; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 9.5%

            let totalInterest = 0;
            let calculationSteps = '<b>–®–∞–≥–∏ —Ä–∞—Å—á–µ—Ç–∞:</b>\n\n';

            for (let i = 0; i < amounts.length; i++) {
                const calcName = calcNames[i].value || `–†–∞—Å—á–µ—Ç ${i + 1}`;
                const amount = parseFloat(amounts[i].value.replace(',', '.'));
                const startPeriod = startPeriods[i].value;
                const endPeriod = endPeriods[i].value;

                if (isNaN(amount) || amount <= 0) {
                    document.getElementById('result').textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.';
                    return;
                }

                const startDate = new Date(startPeriod);
                const endDate = new Date(endPeriod);

                if (startDate > endDate) {
                    document.getElementById('result').textContent = '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è.';
                    return;
                }

                let currentAmount = amount;
                let currentDate = new Date(startDate);

                calculationSteps += `<b>${calcName}:</b>\n\n`;
                while (currentDate <= endDate) {
                    const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
                    const yearDays = (currentDate.getFullYear() % 4 === 0 && (currentDate.getFullYear() % 100 !== 0 || currentDate.getFullYear() % 400 === 0)) ? 366 : 365;

                    const interest = (currentAmount * daysInMonth / yearDays) * rate;
                    totalInterest += interest;
                    calculationSteps += `–ú–µ—Å—è—Ü: ${currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}, –ü–ª–∞—Ç–µ–∂: ${currentAmount.toFixed(2)}, –î–Ω–∏ –≤ –º–µ—Å—è—Ü–µ: ${daysInMonth}, –ü—Ä–æ—Ü–µ–Ω—Ç—ã: ${interest.toFixed(2)}\n`;
                    calculationSteps += `–§–æ—Ä–º—É–ª–∞: (${currentAmount.toFixed(2)} * ${daysInMonth} / ${yearDays}) * ${rate * 100}% = ${interest.toFixed(2)}\n\n`;
                    currentAmount += amount;

                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            }

            document.getElementById('result').textContent = `–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: ${totalInterest.toFixed(2)}`;

            const formula = `–§–æ—Ä–º—É–ª–∞: a * b / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –≥–æ–¥—É * 9.5%\n–ì–¥–µ:\na - —Å—É–º–º–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –Ω–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)\nb - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ\n–ì–æ–¥–æ–≤—ã–µ –¥–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –≥–æ–¥—É –ø–µ—Ä–∏–æ–¥–∞.`;
            calculationSteps = `${formula}\n\n${calculationSteps}`;
            document.getElementById('calculation-process').innerHTML = calculationSteps.replace(/\n/g, '<br>');
        });

        document.getElementById('copy-results').addEventListener('click', function () {
            const calculationContainer = document.getElementById('calculation-process');
            const range = document.createRange();
            range.selectNode(calculationContainer);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.');
            } catch (err) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
            }
            selection.removeAllRanges();
        });
    </script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
        }

        .calculator {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: auto;
            text-align: center;
            margin-top: 20px;
        }

        .calc-form-inline {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .calc-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .calc-name {
            width: 150px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        label {
            margin: 0;
        }

        input[type="number"], input[type="month"] {
            width: auto;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block;
        }

        button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .remove-row {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 5px 10px;
        }
