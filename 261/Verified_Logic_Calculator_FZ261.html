<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ –§–ó ‚Ññ 261</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="calculator">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ –§–ó ‚Ññ 261</h1>
        <form id="calc-form" class="calc-form-inline">
            <div class="calc-input-row">
                <div class="row-top">
                    <button type="button" class="remove-row" title="–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç">-</button>
                    <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                    <label for="amount">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                    <input type="number" class="amount" required>
                    <span>—Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a),</span>
                    <label for="start-period">–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                    <input type="month" class="start-period" required>
                    <label for="end-period">–ø–æ</label>
                    <input type="month" class="end-period" required>
                </div>
                <div class="payment-section">
                    <div class="payment-row">
                        <button type="button" class="remove-payment" title="–£–¥–∞–ª–∏—Ç—å –æ–ø–ª–∞—Ç—É">-</button>
                        <label for="custom-payment">–û–ø–ª–∞—Ç–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:</label>
                        <input type="number" class="custom-payment" placeholder="–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö">
                        <label for="payment-date">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã:</label>
                        <input type="date" class="payment-date" required>
                    </div>
                    <button type="button" class="add-payment" title="–î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É">+</button>
                </div>
            </div>
            <div class="button-row">
                <button type="button" id="add-row">+</button>
                <span class="add-row-text">–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</span>
            </div>
            <div class="submit-button-container">
                <button type="submit" class="submit-button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            </div>
        </form>
        <div id="result"></div>
    </div>
    <div id="calculation-container" class="calculation-container">
        <button id="copy-results" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã">üìã</button>
        <div id="calculation-process" class="calculation-process"></div>
    </div>
    <script>
        document.getElementById('add-row').addEventListener('click', function () {
            const calcForm = document.getElementById('calc-form');
            const newRow = document.createElement('div');
            newRow.classList.add('calc-input-row');

            newRow.innerHTML = `
                <div class="row-top">
                    <button type="button" class="remove-row" title="–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç">-</button>
                    <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                    <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                    <input type="number" class="amount" required>
                    <span>—Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a),</span>
                    <label>–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                    <input type="month" class="start-period" required>
                    <label>–ø–æ</label>
                    <input type="month" class="end-period" required>
                </div>
                <div class="payment-section">
                    <div class="payment-row">
                        <button type="button" class="remove-payment" title="–£–¥–∞–ª–∏—Ç—å –æ–ø–ª–∞—Ç—É">-</button>
                        <label>–û–ø–ª–∞—Ç–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:</label>
                        <input type="number" class="custom-payment" placeholder="–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö">
                        <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã:</label>
                        <input type="date" class="payment-date" required>
                    </div>
                    <button type="button" class="add-payment" title="–î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É">+</button>
                </div>
            `;

            calcForm.insertBefore(newRow, document.querySelector('.button-row'));
            addRemoveRowListener(newRow.querySelector('.remove-row'));
            addPaymentListener(newRow.querySelector('.add-payment'));
        });

        function addRemoveRowListener(button) {
            button.addEventListener('click', function () {
                button.parentElement.parentElement.remove();
            });
        }

        function addPaymentListener(button) {
            button.addEventListener('click', function () {
                const paymentSection = button.parentElement;
                const newPaymentRow = document.createElement('div');
                newPaymentRow.classList.add('payment-row');

                newPaymentRow.innerHTML = `
                    <button type="button" class="remove-payment" title="–£–¥–∞–ª–∏—Ç—å –æ–ø–ª–∞—Ç—É">-</button>
                    <label>–û–ø–ª–∞—Ç–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:</label>
                    <input type="number" class="custom-payment" placeholder="–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö">
                    <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã:</label>
                    <input type="date" class="payment-date" required>
                `;

                paymentSection.insertBefore(newPaymentRow, button);
                addRemovePaymentListener(newPaymentRow.querySelector('.remove-payment'));
            });
        }

        function addRemovePaymentListener(button) {
            button.addEventListener('click', function () {
                button.parentElement.remove();
            });
        }

        document.querySelectorAll('.remove-row').forEach(addRemoveRowListener);
        document.querySelectorAll('.add-payment').forEach(addPaymentListener);
        document.querySelectorAll('.remove-payment').forEach(addRemovePaymentListener);

        
                    document.getElementById('calc-form').addEventListener('submit', function (e) {
                        e.preventDefault();

                        // Ensure all inputs are correctly read
                        const amounts = document.querySelectorAll('.amount');
                        const calcNames = document.querySelectorAll('.calc-name');
                        const startPeriods = document.querySelectorAll('.start-period');
                        const endPeriods = document.querySelectorAll('.end-period');

                        if (amounts.length === 0) {
                            document.getElementById('result').textContent = '–ù–µ —É–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞.';
                            return;
                        }

                        // Additional debug for payment fields
                        const debugPayments = document.querySelectorAll('.custom-payment');
                        debugPayments.forEach((input, idx) => {
                            console.log(`Payment #${idx + 1}:`, input.value);
                        });

                        // Proceed with calculation
    
            e.preventDefault();
            const amounts = document.querySelectorAll('.amount');
            const customPayments = document.querySelectorAll('.custom-payment');
            const paymentDates = document.querySelectorAll('.payment-date');
            const startPeriods = document.querySelectorAll('.start-period');
            const endPeriods = document.querySelectorAll('.end-period');
            const calcNames = document.querySelectorAll('.calc-name');
            const rate = 9.5 / 100; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 9.5%

            let totalInterest = 0;
            let calculationSteps = '<b>–®–∞–≥–∏ —Ä–∞—Å—á–µ—Ç–∞:</b>\n\n';

            function getYearDays(year) {
                switch (year) {
                    case 2025:
                    case 2026:
                    case 2027:
                    case 2029:
                    case 2030:
                    case 2031:
                    case 2033:
                    case 2034:
                        return 365;
                    case 2028:
                    case 2032:
                    case 2035:
                        return 366;
                    default:
                        return (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0)) ? 366 : 365;
                }
            }

            for (let i = 0; i < amounts.length; i++) {
                const calcName = calcNames[i].value || `–†–∞—Å—á–µ—Ç ${i + 1}`;
                let amount = parseFloat(amounts[i].value.replace(',', '.'));

                const startPeriod = startPeriods[i].value;
                const endPeriod = endPeriods[i].value;

                if (isNaN(amount)) {
                    document.getElementById('result').textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞.';
                    return;
                }

                const startDate = new Date(startPeriod);
                const endDate = new Date(endPeriod);

                if (startDate > endDate) {
                    document.getElementById('result').textContent = '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è.';
                    return;
                }

                let currentAmount = amount;
                let currentDate = new Date(startDate);

                calculationSteps += `<b>${calcName}:</b>\n\n`;
                while (currentDate <= endDate) {
                    const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
                    const yearDays = getYearDays(currentDate.getFullYear());

                    const interest = (currentAmount * daysInMonth / yearDays) * rate;
                    totalInterest += interest;
                    calculationSteps += `–ú–µ—Å—è—Ü: ${currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}, –ü–ª–∞—Ç–µ–∂: ${currentAmount.toFixed(2)}, –î–Ω–∏ –≤ –º–µ—Å—è—Ü–µ: ${daysInMonth}, –ü—Ä–æ—Ü–µ–Ω—Ç—ã: ${interest.toFixed(2)}\n`;
                    calculationSteps += `–§–æ—Ä–º—É–ª–∞: (${currentAmount.toFixed(2)} * ${daysInMonth} / ${yearDays}) * ${rate * 100}% = ${interest.toFixed(2)}\n\n`;
                    currentAmount += amount;

                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            }

            document.getElementById('result').textContent = `–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: ${totalInterest.toFixed(2)}`;

            const formula = `–§–æ—Ä–º—É–ª–∞: a * b / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –≥–æ–¥—É * 9.5%\n–ì–¥–µ:\na - —Å—É–º–º–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –Ω–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏)\nb - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ\n–ì–æ–¥–æ–≤—ã–µ –¥–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –≥–æ–¥—É –ø–µ—Ä–∏–æ–¥–∞.`;
            calculationSteps = `${formula}\n\n${calculationSteps}`;
            document.getElementById('calculation-process').innerHTML = calculationSteps.replace(/\n/g, '<br>');
        });

        document.getElementById('copy-results').addEventListener('click', function () {
            const calculationContainer = document.getElementById('calculation-process');
            const range = document.createRange();
            range.selectNode(calculationContainer);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.');
            } catch (err) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
            }
            selection.removeAllRanges();
        });
    </script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
        }

        .calculator {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: auto;
            text-align: center;
            margin-top: 20px;
        }

        .calc-form-inline {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .calc-input-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-wrap: wrap;
        }

        .row-top {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .payment-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .payment-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
        }

        .calc-name {
            width: 150px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        label {
            margin: 0;
        }

        input[type="number"], input[type="month"], input[type="date"] {
            width: auto;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block;
        }

        button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .remove-row, .remove-payment {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .remove-row:hover, .remove-payment:hover {
            background-color: #c82333;
        }

        .add-payment {
            width: 30px;
            height: 30px;
            font-size: 1.2em;

            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .add-payment:hover {
            background-color: #218838;
        }

        #result {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
        }

        #calculation-container {
            margin-top: 20px;
            width: 80%;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
            font-size: 0.9em;
            color: #555;
        }

        #calculation-process b {
            display: block;
            margin-top: 20px;
        }

        #copy-results {
            margin-top: 10px;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em;
        }

        #copy-results:hover {
            background-color: #218838;
        }
    </style>
</body>
</html>