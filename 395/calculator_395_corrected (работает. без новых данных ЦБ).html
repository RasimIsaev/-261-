<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ —Å—Ç. 395 –ì–ö –†–§</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
        }

        .calculator {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: auto;
            text-align: center;
            margin-top: 20px;
        }

        .calc-form-inline {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .calc-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .calc-name {
            width: 150px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        label {
            margin: 0;
        }

        input[type="number"], input[type="month"] {
            width: auto;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ —Å—Ç. 395 –ì–ö –†–§</h1>
        <form id="calc-form" class="calc-form-inline">
            <div class="calc-input-row">
                <button type="button" class="remove-row">-</button>
                <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                <input type="number" class="amount" required> —Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a), 
                <label>–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                <input type="month" class="start-period" required>
                <label>–ø–æ</label>
                <input type="month" class="end-period" required>
            </div>
            <button type="button" id="add-row">+</button>
            <button type="submit">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="calculation-container" class="calculation-container">
        <button id="copy-results" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã">üìã</button>
        <div id="calculation-process" class="calculation-process"></div>
    </div>
    <script>
        const rates = [
            { start: '2022-09-19', end: '2023-07-23', rate: 7.5 },
            { start: '2023-07-24', end: '2023-08-14', rate: 8.5 },
            { start: '2023-08-15', end: '2023-09-17', rate: 12 },
            { start: '2023-09-18', end: '2023-10-29', rate: 13 },
            { start: '2023-10-30', end: '2023-12-17', rate: 15 },
            { start: '2023-12-18', end: '2024-07-28', rate: 16 },
            { start: '2024-07-29', end: '2024-09-15', rate: 18 }
        ];

        function getYearDays(year) {
            return (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0)) ? 366 : 365;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
        document.getElementById('add-row').addEventListener('click', function () {
            const calcForm = document.getElementById('calc-form');
            const newRow = document.createElement('div');
            newRow.classList.add('calc-input-row');

            newRow.innerHTML = `
                <button type="button" class="remove-row">-</button>
                <input type="text" class="calc-name" placeholder="–û–±—ä–µ–∫—Ç">
                <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:</label>
                <input type="number" class="amount" required> —Ä—É–±–ª–µ–π (–∑–Ω–∞—á–µ–Ω–∏–µ a), 
                <label>–ø–µ—Ä–∏–æ–¥ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å</label>
                <input type="month" class="start-period" required>
                <label>–ø–æ</label>
                <input type="month" class="end-period" required>
            `;

            calcForm.insertBefore(newRow, document.getElementById('add-row'));
            addRemoveRowListener(newRow.querySelector('.remove-row'));
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
        function addRemoveRowListener(button) {
            button.addEventListener('click', function () {
                button.parentElement.remove();
            });
        }

        document.querySelectorAll('.remove-row').forEach(addRemoveRowListener);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
        document.getElementById('calc-form').addEventListener('submit', function (e) {
            e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã

            const amounts = document.querySelectorAll('.amount');
            const startPeriods = document.querySelectorAll('.start-period');
            const endPeriods = document.querySelectorAll('.end-period');
            const calcNames = document.querySelectorAll('.calc-name');

            let totalInterest = 0;
            let calculationSteps = '<b>–®–∞–≥–∏ —Ä–∞—Å—á–µ—Ç–∞:</b><br>';

            for (let i = 0; i < amounts.length; i++) {
                const calcName = calcNames[i].value || `–†–∞—Å—á–µ—Ç ${i + 1}`;
                const amount = parseFloat(amounts[i].value);
                const startPeriod = startPeriods[i].value;
                const endPeriod = endPeriods[i].value;

                if (isNaN(amount) || amount <= 0) {
                    document.getElementById('result').textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.';
                    return;
                }

                const startDate = new Date(startPeriod);
                const endDate = new Date(endPeriod);

                if (startDate > endDate) {
                    document.getElementById('result').textContent = '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è.';
                    return;
                }

                let currentAmount = amount;
                let currentDate = new Date(startDate);

                calculationSteps += `<b>${calcName}:</b><br>`;
                while (currentDate <= endDate) {
                    const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
                    const yearDays = getYearDays(currentDate.getFullYear());
                    const applicableRate = rates.find(rate => {
                        const rateStart = new Date(rate.start);
                        const rateEnd = new Date(rate.end);
                        return rateStart <= currentDate && rateEnd >= currentDate;
                    });

                    if (!applicableRate) {
                        document.getElementById('result').textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—Ç–∞–≤–∫–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.';
                        return;
                    }

                    const interest = (currentAmount * daysInMonth / yearDays) * (applicableRate.rate / 100);
                    totalInterest += interest;

                    calculationSteps += `–ú–µ—Å—è—Ü: ${currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}, –ü–ª–∞—Ç–µ–∂: ${currentAmount.toFixed(2)}, –î–Ω–∏ –≤ –º–µ—Å—è—Ü–µ: ${daysInMonth}, –ü—Ä–æ—Ü–µ–Ω—Ç—ã: ${interest.toFixed(2)}<br>`;
                    calculationSteps += `–§–æ—Ä–º—É–ª–∞: (${currentAmount.toFixed(2)} * ${daysInMonth} / ${yearDays}) * ${applicableRate.rate}% = ${interest.toFixed(2)}<br><br>`;

                    currentAmount += amount;
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            }

            document.getElementById('result').textContent = `–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: ${totalInterest.toFixed(2)} —Ä—É–±.`;
            document.getElementById('calculation-process').innerHTML = calculationSteps;
        });

        document.getElementById('copy-results').addEventListener('click', function () {
            const calculationContainer = document.getElementById('calculation-process');
            const range = document.createRange();
            range.selectNode(calculationContainer);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.');
            } catch (err) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
            }
            selection.removeAllRanges();
        });
    </script>
</body>
</html>
